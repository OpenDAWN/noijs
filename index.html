<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
</head>
<body>
  <canvas id="noise" width="320" height="200"></canvas>
  <script src="simplex.js"></script>
  <script>

var noijs = SimplexNoise.create(3);

(function(document, noise) {

  function scale(v) {
    return 128 + v * 128;
  }

  function img(idata, noise, f, t) {
    for (var y=0; y<idata.height; y++) {
      var p = idata.width*y*4;
      var tmp;
      for (var x=0; x<idata.width; x++, p+=4) {
        var v = noise(x*f, y*f, t);
        for (var i=2, j=3; i<=8; tmp = i, i+=j, j=tmp) {
          v += noise(x*f*i, y*f*i, t)/i;
        }
        v = scale(v);
        idata.data[p] = v;
        idata.data[p+1] = v
        idata.data[p+2] = v;
        idata.data[p+3] = 255;
      }
    }
  }

  var canvas = document.getElementById('noise');
  var ctx = canvas.getContext('2d');
  var idata = ctx.createImageData(canvas.offsetWidth, canvas.offsetHeight);
  var t = 0;
  var freq = 0.01;

  function animate() {
    img(idata, noise, freq, t);
    requestAnimationFrame(function () {
      ctx.putImageData(idata, 0, 0);
    });
    t += 0.1;
  }

  function coords(x, y, f) {
    var v = noise(x*f, y*f, t);
    var txt = ( '(' + (Math.round(100*x*f)/100) +
                ', '+ (Math.round(100*y*f)/100) +
                ', '+ (Math.round(100*t)/100) + ') => ' + (Math.round(v*1000)/1000) );
    ctx.putImageData(idata, 0, 0);
    ctx.fillText(txt, x, y);
  }

  animate();

  var i = null;
  canvas.onmousemove = function(e) {
    var x = e.clientX - e.target.offsetLeft;
    var y = e.clientY - e.target.offsetTop;
    coords(x, y, freq);
    clearInterval(i);
    i = null;
  };
  canvas.onclick = function() {
    if (i !== null) {
      clearInterval(i);
      i = null;
    } else {
      i = setInterval(animate, 100);
    }
  };
})(document, noijs);

  </script>
</body>
</html>
